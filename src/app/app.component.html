<div class="todo-container d-flex">
  <div class="card text-center todo-tasks pb-2">
    <div class="card-header header-container bg-info pb-0">
      <ul class="nav nav-pills header-tab-group card-header-pills">
        <li
          class="nav-item"
          [ngClass]="{ active: showProperty == 'All' }"
          (click)="displayAllTasks()"
        >
          All
        </li>
        <li
          class="nav-item"
          [ngClass]="{ active: showProperty == 'To Do' }"
          (click)="displayToDoTasks()"
        >
          To Do
        </li>
        <li
          class="nav-item"
          [ngClass]="{ active: showProperty == 'In Progress' }"
          (click)="displayInProgressTasks()"
        >
          In Progress
        </li>
        <li
          class="nav-item"
          [ngClass]="{ active: showProperty == 'Completed' }"
          (click)="displayCompletedTasks()"
        >
          Completed
        </li>
      </ul>
    </div>
    <div class="card-body pb-0 pt-0 task-container">
      <div class="task-group ps-0 pb-0 mb-0">
        <ng-container
          *ngFor="let task of tasksToDisplay; let i = index; let last = last"
        >
          <div
            class="card-text text-start task-item d-flex pt-3 pb-3"
            [ngClass]="last ? 'mb-0 pb-0' : 'task-separator'"
            #taskDiv
          >
            <span (click)="toggleMarkAsCompleted(task)">
              <img
                class="task-status-toggle-icon m-2 mt-0"
                *ngIf="task?.status != 'Completed'"
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAOGSURBVHgBzVnbUeMwFL02jx8GyHbg8Pjgi6QCnAqWrWDpALaCkAqWdEAHsBXEVBDvFx/ARNuBhxl+YIA9x8gZWVGCnZc5M8JYkqWjI+nq6saTKXF3dxf6vt/Av0dIfNZ0IhIkxfT29vYXz2h/fz+SKeCVqdzv92vAKTo9M8gUhUKKnp+fOwcHB6roR4UIamJtTWweuCxK9FOCg8GAip1LecU+g3p/f+/s7e1dTqo0kSDI/Z6gGtfZ9evr683a2lrMDuv1eqK/42AClHFthp7nfZfxA7zY3d39JWUIckq3t7evMMLQUZyOfGVl5TojVAT39/cnINomcUdx/Pj42Go2m0khgg8PD3352JkmEqjZwW68kBmAtjkjJJpTFOSjnZ2dlnxGcMy0KpiUFhRTMgegjwB99GRUzZHp9s0XToODXDxPcgTbYptQLbaKzrTCQwwVvL29DdbX1+1RqXmTMzFGyQTrsZ6tx6GCIGcv4GSR5IhMSfmwCBlqW1tb7ewlJUj18DgxP+aGWCQ5kyQeHSv7jJZEMoJaPRNq1t1aBtgY7EuZeVAxXYvZFIdmIe2cLBmOPk/5x9NeSc8oSDCib7Jk8PTBshqIYR/x3qKCoVX3WioATyWo+MfKbkA8/9DMQaUbqQhQLDLfYSdDKhhYlWKpDrm+QfBwhODT05OSigCvSFlZNRLMHdouj2JZcHhHNV++OEgwxzqz4FVAO7omkhGCGxsbgVSEl5eXwMpSJGjv2oZUBH2NHQIm7x8J5uweXPkjqQgwK7m+QTD2HXbvuMJ1eGy9R76+8ef8sc3NzWNZMujNS97k0aOKUjMDFbtmZX37WiocfUb8kxJcXV21fb/AvhssEgwOiHWiYcOk7ldKUHsSXeu7tva0Fwr2oSMXJi4zb354kmD3slJuLfIStUiSxkUtt/Yy9XIE9Tloe7Vs4GoRJDW5K7Gmlp61eRcaubhjN11gwZ5a2QrRqFaZsFkBcj0HuS6CSe57sUWyR2fRyk4V1hecqTEhWhaj7aZd3xvTSA2j6SG5jr1CYTMTNPy0reOCR2gvwh744QpGTQy/jZnuDGn4jVcEnkZ0dDNfkoS009HQRycNv/N0ck1rYYKa5KSw2SwoFC0rFAJmDAXByHMQ/SlzAFWjWSsSXywVRDeIctoCKQcq1uWpVSbwWYqgCV748Qj1tTXQyfwZgomeUrpGp/0Z4j9zB7/tmDVE9gAAAABJRU5ErkJggg=="
                alt="Incomplete Task"
              />
              <img
                class="task-status-toggle-icon m-2 mt-0"
                *ngIf="task?.status == 'Completed'"
                src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAQJSURBVHgBvVnNdRMxEB4tLw+Hk+lgqSDuwHYFQAWYCuyccLjYvkDgkqQCQgWECuJUEFMBogOfiHl5sZjRrLL62/XueuF7zz+RtZpPo/lGI0VAU0zVALbQAwF9fPVAQRc/u/o3BWtIQOLvEtt+YMsSTsUSGkDU6j1RXejAGAlMHslUhwQiCrBAsrLqQ9UIErFDmGli7eASKhLdTfCdGuP7vIHHdkECk7ws61RO8ESdFXqN4kzAFX67wXhbwW80eC7W+jfy+DNIdYwCDLDvy8IJCjiHj+IYahHkWPumBw8hgWa+QXKGUBVM1QjfZ/hKIWSxgjsYxsaLEzxRtzjrntPGylzgbM9hH5yoCXp2FvEoKX0IOwnGl1Xia1hHfaWYqhTfr8H3ZmS5E+/BUUCO3N8mOQKPNURbK6edbJOHHfM5uRTCWcnWyREoM/ASfw1sCgylO3hh4tH2oBvAFHP/gtx71dNLyamrD+zJtWWXc24GJsjeGzkDJfUyfiWQna3ODgYTbYNs2aClpkwCuQdn3lByb7X6YIP2ckok8lp/Y1vS6d9hLRiCA2+4BbSNQy+EEiTnrpBrU8CYP6gq4ZmZH9Y4o+fQJqaKyM0tG8fBCpGHn8JPLz8OyYMDp6PS21d7MHt5jniyJ9UK+O60YRmXIKEjr+sNtAUW39wyeIXLOi95Yun8tYUBeTB1Gh+85NkUJq/mSyYxv70tfca3LeAoJHjvqakJYoqFeDFQahsnlwSbdmwQ8kaWlypht2Lj8G0rIrgLxhsdJ8EWgxRr7+ek2A+icdgkzjaTE8pxCF+AvTHQlU4Zqiq2CL5tTHmJzns2DryYVPpUZr4H1cYj6is2xEFQzMokKHmeeIUqG7mAnORZltx9cvUUG4Nvewu/iKCf9/rBg6di4kxEYDwyqeaKjcO1jbVoog88buOrqGKF3til/q6ASZnjaBPFxqDQtotlok/8fj3WCTraVbDpm+q9sy3FUjXvpjxJ3JJs4Auv+yw6CJFUVmy5A+57oPJtLumNCW7AHzgtVOtncQVhaVRfsTY4PaVe6yInyAEdetEIwYer7GaKNfDTE+PSxHG+k2ywkx+LJIRikpPsZqGpYmPpiSDBWiH3XEzLSnnOBh071R7KLCNH6cq/IABcDeu+RkQepHgce60S/sfBXWHYfBJO7IfFwqnusPRaaba3hcKpAxKEwrHCW4WVT46bY+DzwbW+OQ0hocK1WTAe59b45RE5ZINhVPnyyCC+3Az7+o0q4Xvv+o02ft5b+3qHKLp+iyxrdYJMcgTFM2+Oirdl1a6A81z1BtoAee0PjlchPVUjaJATpaojrfNoFhIXeteqkTfrEbTBNeGATl5Yt6XASu9aZNZamQ/ZFXHDf0P8BZMAoyrAi/4RAAAAAElFTkSuQmCC"
                alt="Completed Task"
              />
            </span>
            <!--<fa-icon [icon]="['far', 'square']"></fa-icon>
            <br />
            <fa-icon [icon]="['far', 'check-square']"></fa-icon>-->
            <div class="task-detail w-100">
              <div
                class="m-0 mb-2 task-name"
                *ngIf="task.status != 'Completed'"
              >
                {{ task.name }}
              </div>
              <div
                class="m-0 mb-2 task-name-completed"
                *ngIf="task.status == 'Completed'"
              >
                <del>{{ task.name }}</del>
              </div>
              <div class="task-description m-0 mb-2">
                {{ task?.description }}
              </div>
              <div class="d-flex">
                <div class="me-2">{{ getFormattedDate(task.dueDate) }}</div>

                <!--<fa-icon [icon]="['far', 'tag']"></fa-icon>

          <i
            class="fa-light fa-tag"
            style="color: #ff0000"
            *ngIf="task.priority === 'high'"
          ></i>
          <i
            class="fa-light fa-tag"
            style="color: #ffff00"
            *ngIf="task.priority === 'medium'"
          ></i>
          <i
            class="fa-light fa-tag"
            style="color: #00ff37"
            *ngIf="task.priority === 'low'"
          ></i> -->
                <span>&nbsp;|&nbsp;</span>
                <div ngClass="{{ getClassFromPriority(task.priority) }}">
                  {{ task.priority.toString() }}
                </div>
                <span>&nbsp;|&nbsp;</span>
                <div>
                  {{ task.status.toString() }}
                </div>
              </div>
            </div>
            <div class="option-container" *ngIf="taskToEdit?.id != task.id">
              <!-- <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item>
                  <mat-icon>edit</mat-icon>
                  <span>Edit</span>
                </button>
                <button mat-menu-item>
                  <mat-icon>delete</mat-icon>
                  <span>Delete</span>
                </button>
              </mat-menu> -->
              <mat-icon
                (click)="openEditTaskCardModel(task)"
                class="edit m-1 p-1"
                matTooltip="Edit"
                >edit</mat-icon
              >
              <mat-icon
                (click)="deleteTaskFromList(task, taskDiv)"
                class="delete m-1 p-1"
                matTooltip="Delete"
                >delete</mat-icon
              >
            </div>
          </div>
          <div class="overlay">Task is deleted</div>
        </ng-container>
      </div>
    </div>
  </div>
  <div class="card text-center m-2 ms-0 me-0 p-3 add-task">
    <div
      *ngIf="!shouldDisplayForm"
      [@heightAnimation]
      (click)="displayForm()"
      class="add-task-button pointer-cursor align-items-center d-flex justify-content-center"
    >
      <mat-icon>add_circle</mat-icon>
      <span> Add Task </span>
    </div>
    <span class="overflow-hidden" *ngIf="shouldDisplayForm" [@heightAnimation]>
      <form (ngSubmit)="upsertTaskInTaskList(form)" #form="ngForm">
        <div class="input-container d-flex flex-column">
          <div class="text-input-container d-flex flex-column">
            <input
              matInput
              type="number"
              name="id"
              ngModel
              required
              [ngModel]="taskToEdit?.id"
              hidden
            />
            <mat-form-field>
              <mat-label>Task</mat-label>
              <input
                matInput
                type="text"
                name="name"
                ngModel
                required
                [ngModel]="taskToEdit?.name"
              />
            </mat-form-field>
            <mat-form-field>
              <mat-label>Description</mat-label>
              <textarea
                matInput
                type="textarea"
                cdkTextareaAutosize
                cdkAutosizeMinRows="1"
                cdkAutosizeMaxRows="4"
                name="description"
                ngModel
                [ngModel]="taskToEdit?.description"
              ></textarea>
            </mat-form-field>
          </div>
          <div class="d-flex gap-3 align-items-center justify-content-between">
            <mat-form-field>
              <mat-label>Choose Date</mat-label>
              <input
                matInput
                [matDatepicker]="picker"
                name="dueDate"
                ngModel
                required
                [ngModel]="taskToEdit?.dueDate"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="picker"
              ></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
            <mat-form-field>
              <mat-label>Set Priority</mat-label>
              <mat-select
                name="priority"
                [ngModel]="taskToEdit?.priority"
                ngModel
                required
              >
                <mat-option
                  *ngFor="let taskPriority of taskPriorities"
                  [value]="taskPriority"
                >
                  {{ taskPriority }}
                </mat-option>
              </mat-select>
            </mat-form-field>
            <mat-form-field>
              <mat-label>Set Status</mat-label>
              <mat-select
                name="status"
                [ngModel]="taskToEdit?.status"
                ngModel
                required
              >
                <mat-option
                  *ngFor="let taskStatusType of taskStatusTypes"
                  [value]="taskStatusType"
                >
                  {{ taskStatusType }}
                </mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="control-option d-flex gap-2 justify-content-end">
            <button
              (click)="hideForm()"
              type="button"
              class="button-width-85 btn btn-dark"
            >
              Cancel
            </button>
            <button
              type="submit"
              class="button-width-85 btn btn-primary"
              [disabled]="!form.valid"
            >
              <span *ngIf="taskToEdit == null">Add</span>
              <span *ngIf="taskToEdit != null">Update</span>
            </button>
          </div>
        </div>
      </form>
    </span>
  </div>
</div>
